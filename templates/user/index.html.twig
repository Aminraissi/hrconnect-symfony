{% extends 'base.html.twig' %}

{% block title %}{{ 'user.index.title'|trans }}{% endblock %}

{% block body %}
<div class="mb-3">
    <form method="get" action="">
        <select name="_locale" onchange="this.form.submit()" class="form-select w-auto d-inline-block">
            <option value="en" {% if app.request.get('_locale') == 'en' %}selected{% endif %}>English 🇬🇧</option>
            <option value="fr" {% if app.request.get('_locale') == 'fr' %}selected{% endif %}>Français 🇫🇷</option>
        </select>
    </form>
</div>

<h1>{{ 'user.index.title'|trans }}</h1>

<div class="d-flex justify-content-between align-items-center mb-3">
    <a href="{{ path('app_user_download_pdf') }}" class="btn btn-primary">{{ 'user.index.download_pdf'|trans }}</a>
</div>
<form method="get" action="{{ path('app_user_index') }}" class="mb-3 d-flex justify-content-between align-items-center">
    <input type="text" name="search" value="{{ search }}" placeholder="🔍 Search..." class="form-control w-25" />

    <input type="submit" class="btn btn-secondary ms-2" value="Search">
</form>

<table class="table table-striped table-hover">
    <thead>
        <tr>
<th>
    <a href="{{ path('app_user_index', app.request.query.all|merge({'sort': 'u.cin', 'direction': direction == 'asc' and sort == 'u.cin' ? 'desc' : 'asc'})) }}">
        {{ 'user.index.cin'|trans }}
    </a>
</th>
<th>
    <a href="{{ path('app_user_index', app.request.query.all|merge({'sort': 'u.tel', 'direction': direction == 'asc' and sort == 'u.tel' ? 'desc' : 'asc'})) }}">
        {{ 'user.index.tel'|trans }}
    </a>
</th>
<th>
    <a href="{{ path('app_user_index', app.request.query.all|merge({'sort': 'u.nom', 'direction': direction == 'asc' and sort == 'u.nom' ? 'desc' : 'asc'})) }}">
        {{ 'user.index.nom'|trans }}
    </a>
</th>
<th>
    <a href="{{ path('app_user_index', app.request.query.all|merge({'sort': 'u.prenom', 'direction': direction == 'asc' and sort == 'u.prenom' ? 'desc' : 'asc'})) }}">
        {{ 'user.index.prenom'|trans }}
    </a>
</th>
<th>
    <a href="{{ path('app_user_index', app.request.query.all|merge({'sort': 'u.email', 'direction': direction == 'asc' and sort == 'u.email' ? 'desc' : 'asc'})) }}">
        {{ 'user.index.email'|trans }}
    </a>
</th>

            <th>{{ 'user.index.roles'|trans }}</th>
<th>Active</th>
            <th>{{ 'user.index.actions'|trans }}</th>
        </tr>
    </thead>
    <tbody>
    {% for user in pagination %}
        <tr>
            <td>{{ user.cin }}</td>
            <td>{{ user.tel }}</td>
            <td>{{ user.nom }}</td>
            <td>{{ user.prenom }}</td>
            <td>{{ user.email }}</td>
            <td>{{ user.roles|join(', ') }}</td>
<td>
    {% if 'ROLE_INACTIVE' in user.roles %}
        <a href="{{ path(app.request.attributes.get('_route'), app.request.query.all|merge({'toggleUser': user.id})) }}">
            <img src="{{ asset('images/switch_red.png') }}" alt="Inactive" width="40">
        </a>
    {% else %}
        <a href="{{ path(app.request.attributes.get('_route'), app.request.query.all|merge({'toggleUser': user.id})) }}">
            <img src="{{ asset('images/switch_green.png') }}" alt="Active" width="40">
        </a>
    {% endif %}
</td>
            <td>
                <a class="btn btn-info" href="{{ path('app_user_show', {'cin': user.cin}) }}">{{ 'user.index.show'|trans }}</a>
                <a class="btn btn-warning" href="{{ path('app_user_edit', {'cin': user.cin}) }}">{{ 'user.index.edit'|trans }}</a>
            </td>
        </tr>
    {% else %}
        <tr>
            <td colspan="8">{{ 'user.index.no_records'|trans }}</td>
        </tr>
    {% endfor %}
    </tbody>
</table>

<div class="d-flex justify-content-center mt-4">
    {{ knp_pagination_render(pagination) }}
</div>

<a href="{{ path('app_user_new') }}" class="btn btn-success mt-3">{{ 'user.index.create'|trans }}</a>

{% endblock %}
